package Jegmezo;
//
//
//  Generated by StarUML(tm) Java Add-In
//
//  @ Project : Untitled
//  @ File Name : Jégtábla.java
//  @ Date : 25/03/2020
//  @ Author : 
//
//

import java.util.ArrayList;
import java.util.List;
import java.util.Map;

import java.util.TreeMap;

public class Jegtabla implements Frissitheto
{
	private Jegmezo jegmezo;
	private boolean atVanFordulva;
	private int ho;
	private int tartokepesseg;
	
	private TreeMap<Integer, Integer> szomszedokSorszambolSzogge;
	private TreeMap<Integer, Integer> szomszedokSzogbolSorszamma;
	private List<Jegtabla> szomszedokASorszamhoz;
	
	private int szomszedokSzama;
	
	private Vedelem jegtablaVedelme;
	private List<Jatekos> jatekosok;
	private List<Jegesmedve> jegesmedvek;
	private Targy targy;
	
	public String ID;
	
	
	/**
	 * A jégtábla konstruktora, ami létrehozza jégtáblát, a megadott paraméterekkel
	 * @param jegmezo - A jégmezõ, amin van
	 * @param atVanFordulva - azt adja meg, hogy át van-e fordulva
	 * @param ho - a kezdeti hómennyiséget adja meg
	 * @param tartokepesseg - a tartóképességét adja meg
	 * @param targy - a benne lévõ tárgyat adja meg. Ha nincs benne tárgy, akkor null legyen az értéke
	 */
	public Jegtabla(Jegmezo jegmezo,
	boolean atVanFordulva,
	int ho,
	int tartokepesseg,
	int szomszedokSzama)
	{
		this.jegmezo = jegmezo;
		
		this.atVanFordulva =atVanFordulva;
		this.ho = ho;
		this.tartokepesseg = tartokepesseg;
		
		this.szomszedokSzama = szomszedokSzama;
		
		szomszedokSorszambolSzogge = new TreeMap<>(); 
		szomszedokSzogbolSorszamma = new TreeMap<>(); 
		
		szomszedokASorszamhoz  = new ArrayList<>(this.szomszedokSzama);;
	
		
		jegtablaVedelme = null;
		
		jatekosok = new ArrayList<>(); 
		this.targy = null;
		this.jegmezo.addFrissitheto(this);
		jegesmedvek = new ArrayList<>();
		
		System.out.println("Letrehoztak egy jegtablat");
	}
	
	
	public Jegtabla(String id,
			Jegmezo jegmezo,
			boolean atVanFordulva,
			int ho,
			int tartokepesseg,
			int szomszedokSzama)
			{
		ID = id;
				this.jegmezo = jegmezo;
				
				this.atVanFordulva =atVanFordulva;
				this.ho = ho;
				this.tartokepesseg = tartokepesseg;
				
				this.szomszedokSzama = szomszedokSzama;
				
				szomszedokSorszambolSzogge = new TreeMap<>(); 
				szomszedokSzogbolSorszamma = new TreeMap<>(); 
				
				szomszedokASorszamhoz = new ArrayList<>(this.szomszedokSzama);
			
				
				jegtablaVedelme = null;
				
				jatekosok = new ArrayList<>(); 
				this.targy = null;
				this.jegmezo.addFrissitheto(this);
				jegesmedvek = new ArrayList<>();
				
				System.out.println("Letrehoztak egy jegtablat");
			}
	
	
	/**
	 * Felveszi a játékost a táblára és átállítja az aktjegtabla attribútumát
	 * @param j - a játékos, akit hozzá akarunk adni a táblához
	 * @return visszaadja, hogy sikerült-e felvenni a játékost a jégtáblára
	 */
	public void addJatekos(Jatekos j)
	{
		
		System.out.println("Jegtabla: Epp egy jatekost adnak hozzam ");
			j.setaktjegtabla(this);
			j.setSzogAmibeNez(this.szomszedokSorszambolSzogge.get(0));
			jatekosok.add(j);
	}
	
	/**
	 * Hozzáadja a paraméterben megadott jegesmedvét a jégtáblához és beállítja a jegesmedbe jegtablaAminAll attribútumát
	 * @param j - A jegesmedve, akot hozzá akarunk adni a Jégáblához
	 */
	public void addJegesmedve(Jegesmedve j)
	{
		System.out.println("Jegtabla: epp hozzamadnak egy jegesmedvet");
		System.out.println("Jegesmedve a jegtablara elhelyezve");
			j.setjegtablaAminAll(this);
			j.setSzogAmibeNez(this.szomszedokSorszambolSzogge.get(0));
			jegesmedvek.add(j);
	}
	
	/**
	 * Csökkenti a Jégtábla hó mennyiségét i-vel, ha nulla alá megy a hó, akkor -1-re állítjuk a hómennyiséget és a rajta lévõ tárgyat kiásottnak tekintjük.
	 * Ha -1 vagy az alatti a hó mennyiség nem történik semmi
	 * @param i - A mennyiség, amivel a havat csökkenteni szeretnénk
	 * @return Visszaadja, hogy történt-e ásás
	 */
	public boolean asas(int i)
	{
		System.out.println("Jegtabla: Epp asni akarnak rajtam " + i + " mennyisegu havat");
		if(ho >= 0)
		{
			int tempHo = ho;
			
			ho -= i;
			if(ho <= -1)
			{
				ho = -1;
				System.out.println("Jegtabla: Kiastad a rajtam levo targyat");
			}
			System.out.println("Jegtabla: Van rajtam ho szoval ezt megtehetik a hoszintem " + tempHo + "-rol " +  ho + "-ra csokkent");
			
			return true;
		}
		else
		{
			System.out.println("Jegtabla: Nincs rajtam ho szoval ezt nem tehetik meg a hoszintem maradt: " + ho);
			return false;
		}
		
	}
	

	
	/**
	 * Átfordítja a táblát és törli a rajta lévõ védelmet
	 */
	public void atfordit()
	{
		atVanFordulva = true;
		System.out.println("Jaj! Felfordult a tábla!");
		this.jegtablaVedelme = null;
	}
	
	
	/**
	 * Azt adja meg, hogy a Játekos elhagyhatja-e a Jégtáblát 
	 * @param j - Am játékos aki el akarja hagyni a Jégtáblát
	 * @return Visszaadja, hogy a Játékos elhagyhatja-e a Jégtáblát
	 */
	public boolean ellep(Jatekos j)
	{
		System.out.println("Jegtabla: egy jatekos megproba ellepni rolam");
		if(atVanFordulva)
		{
			System.out.println("A jegtabla at van fordulva, a jatekos csak buvarruhaval hagyhatja el");
			return false;
		}
		else
		{
			this.jatekosEltavolit(j);
			System.out.println("A jatekos elhagyhatja a jegtablat es el lett tavoitva innen");
			return true;
		}
	}

	
	
	/**
	 * Új kör elején megnézi, hogy át van-e fordulva és ha igen és vannak rajta játékosok, akkor szól a jégmezõnek, 
	 * hogy ezek a játékosok meghaltak.
	 * Ha át van fordulva és nincs rajta senki akkor visszafordítjuk a jégtáblát
	 * Meghívja a rajtalévõ védelem frissites függvényét
	 */
	public void frissit()
	{	
		System.out.println("Jegtabla: epp frissitenek");
		System.out.println("Jegtabla: frissitem a vedelmemet is");
		if(jegtablaVedelme != null)
			jegtablaVedelme.frissit();
		
		
		if(atVanFordulva) {
			System.out.println("Jegtabla: epp frissitenek es at vagyok fordulva");
			for(int i = 0; i < jatekosok.size(); i++)
			{
				System.out.println("Jegtabla: ezert a jatekosok, akik rajtam vannak halalnak fiai");
				jegmezo.meghalt(jatekosok.get(i));
			}
				
		
			if(jatekosok.size() == 0)
			{
				System.out.println("Jegtabla: Nincs rajtam senki ezert visszafordulok");
				visszaFordit();
			}
		}
	}
	


	
	/**
	 * növeli a havat a jégtáblán
	 */
	public void hoNovelese()
	{
		System.out.println("Jegtabla: epp a hoszintemet novelik");
		ho++;
		System.out.println("Ho mennyisege megnovelve");
	}
	
	
	/**
	 *meghívja a honoveles fügvényt
	 */
	public void hovihar()
	{
		System.out.println("Jegtabla: epp hoviharban vagyok");
		if(jegtablaVedelme==null)
		{
			System.out.println("Jegtabla: a hovihar kovetkezteben no rajtam a ho");
			this.hoNovelese();
		}
		else {
			jegtablaVedelme.hovihar();
		}
		
	}
	

	
	
	/**
	 * Eltávolítja paraméterben megadott játékost a jégtábla játékosai közül
	 * @param j - A Játékos, akit el akarunk távolítni
	 */
	public void jatekosEltavolit(Jatekos j)
	{
		System.out.println("Jegtabla: epp eltavolitanak rolam egy jatekost");
		jatekosok.remove(j);
		System.out.println("Jatekos eltavolitva a tablarol");
	}
	
	

	
	public List<Jatekos> jatekosokLekerdez()
	{
		System.out.println("Jegtabla: epp a jatekosaimat kerdezik le");
		return jatekosok;
	}
	
	
	
	/**
	 * Eltávolítja a paraméterben megadott jegesmedvét a jégtábláról
	 * @param j - A jegesmedve, akit el akarunk távolítani a Jégtábláról
	 */
	public void JegesmedveEltavolit(Jegesmedve j)
	{
		System.out.println("Jegtabla: epp eltavolitanak rolam egy jegesmedvet");
		jegesmedvek.remove(j);
		System.out.println("Jegesmedve eltavolitva a tablarol");
	}
	
	
	/**
	 * Eltávolítja a Jégtáblán lévõ védelmet
	 */
	public void jegtablaVedelmenekEltavolitasa()
	{
		System.out.println("Jegtabla: most epp a rajtam levo vedelmet eltavolitjak");
		jegtablaVedelme = null;
		System.out.println("Jegtabla vedelme eltavolitva");
	}
	
	
	/**
	 * Rálépteti a megadott játékost a táblára és ha játékosok száma így meghaladja a tartóképességet, átfordítja a táblát
	 * @param j - A Játékos, aki rálép a táblára 
	 */
	public void ralep(Jatekos j)
	{
		System.out.println("Jegtabla: epp ram lep egy jatekos");
		j.setaktjegtabla(this);
		j.setSzogAmibeNez(this.szomszedokSorszambolSzogge.get(0));
		System.out.println("Jegtabla: hozzaadom a jatekos gyujtemenyembe");
		jatekosok.add(j);
		System.out.println("Jegtabla: A jatekos ralepett a tablara");
		
		System.out.println("Jegtabla: Most megnezem, hogy nincsenek-e rajtam sokan es ha igen, akkor atforditom magam");
		if(jatekosok.size() > tartokepesseg)
			atfordit();
			
	}
	

	
	/**
	 * visszaadja a jégtábla i irányban lévõ szomszédját 
	 * @param i - az irány amibe tudni szeretnénk a szomszédot
	 * @return visszaadja az i irányban lévõ szomszédot
	 */
	//Új
	public Jegtabla szomszedKerdez(Integer szogbe)
	{
		System.out.println("Jegtabla: Epp a szomszedomat kerdezik");
		//int idx = 0;
		//(Jobb(0), Bal(1), Fel(2),Le(3))
		/*switch(i) {
			case Jobb:
				idx = 0;
				break;
			case Bal:
				idx = 1;
				break;
			case Fel:
				idx = 2;
				break;
			default:
				idx = 3;
				break;
		}*/
		return this.szomszedokASorszamhoz.get(this.szomszedokSzogbolSorszamma.get(szogbe));
	}
	
	//Új
	public Integer adottSzogbeLevoSzomszedMellettiSzomszedSzoge(Integer szog, boolean jobbra)
	{
		Integer sorszam = this.szomszedokSzogbolSorszamma.get(szog);
		if(jobbra)
		{
			
			Integer jobbraLevoSzomszedSorszama = sorszam == szomszedokSzama - 1? 0: sorszam + 1;
			
			return this.szomszedokSorszambolSzogge.get(jobbraLevoSzomszedSorszama);
				
		}
		else
		{
			Integer balraLevoSzomszedSorszama = sorszam == 0? szomszedokSzama - 1: sorszam - 1;
			return this.szomszedokSorszambolSzogge.get(balraLevoSzomszedSorszama);
		}
	}
	
	
	
	/**
	 * Meghívja a rajtalévõ tárgy felvesz függvényét, ha a hó rajta -1
	 * @param j - a Játékos, aki fel akarja venni a tárgyat
	 * @return Visszaadja, hogy sikeres volt-e a tárgyfelvétel
	 */
	public boolean targyFelvesz(Jatekos j)
	{
		System.out.println("Jegtabla: megprobaljak felvenni rolam a targyat");
		if(ho == -1)
		{
			if(targy != null)
			{
				boolean sikeres =  targy.felvesz(j);
				if(sikeres)
				{
					System.out.println("A jegtablarol valo targy felvetel sikeres volt");
					targy = null; // töröljük a tárgyat a tábláról
				}
				
				else 
					System.out.println("A jegtablarol valo targy felvetel nem volt sikeres");
				
				
				return sikeres;
			}
			else
			{
				System.out.println("A jegtablan nincs targy");
				return false;
			}
		
		}
		else
		{
			System.out.println("A jegtablan levo targyat meg ho takarja");
			return false;
		}
	}
	
	
	/**
	 * Visszafordítja a táblát
	 */
	public void visszaFordit()
	{
		atVanFordulva = false;
		System.out.println("A jegtabla visszafordult");
	}
	
		
	
	/**
	 * @return Visszaadja, hogy a jégtábla át van-e fordulva
	 */
	public boolean getAtVanFordulva()
	{
		System.out.println("Jegtabla: most azt kerdzik, hogy at vagyo-e forditva");
		return atVanFordulva;
	}
	
	
	
	
	/**
	 * @return Visszadja a jegtabla homennyiseget
	 */
	public int getHo()
	{
		System.out.println("Jegtabla: most epp a rajtam levo homennyiseget kerdezik");
		return ho;
	}
	
	

	/**
	 * @return Visszaadja a jégtáblán lévõ védelmet vagy nullt, ha nincs rajta védelem
	 */
	public Vedelem getjegtablaVedelme()
	{
		System.out.println("Jegtabla: most epp a rajtam levo vedelemet kerdezik le");
		return jegtablaVedelme;
	}
	
	
	
	/**
	 * @return Visszaadja, hogy hány játékost bír el a Jégtábla
	 */
	public int gettartokepesseg()
	{
		System.out.println("Jegtabla: epp a tartokepessegem kerdezik");
		return tartokepesseg;
	}
	

	/**
	 * Beállítja a jégtábla védelmét a megadott Védelemre
	 * @param v - A védelem, amit be akarunk állítani a Jégtáblára
	 */
	public void setjegtablaVedelme(Vedelem v)
	{
		v.setJegtablaAminVan(this);
		System.out.println("Jegtabla: most epp a rajtam levo vedelemet allitjak at");
		jegtablaVedelme = v;
		System.out.println("Jegtabla: Vedelem atallitva");
	}

	/**
	 * Hozzáadja a megadott irányú szomszédaihoz a megadott jégtáblát
	 * @param j - a jégtábla, amit fel akarunk venni a szomszédok közé
	 * @param i - azt adja meg, hogy a jégtáblának melyik irányba lesz a szomszédja
	 */
	public void setSzomszed(Jegtabla j,Integer hanyadikSzomszed, Integer melyikSzogbol)
	{
		System.out.println("Nekem a jegtablanak epp a szomszedjat allitjak be ");
		int idx = 0;
		
		szomszedokSorszambolSzogge.put(hanyadikSzomszed, melyikSzogbol);
		szomszedokSzogbolSorszamma.put(melyikSzogbol, hanyadikSzomszed);
		
		szomszedokASorszamhoz.set(hanyadikSzomszed, j);
		
		//(Jobb(0), Bal(1), Fel(2),Le(3))
		/*switch(i) {
			case Jobb:
				idx = 0;
				break;
			case Bal:
				idx = 1;
				break;
			case Fel:
				idx = 2;
				break;
			default:
				idx = 3;
				break;
		}
			
		szomszedok.set(idx, j);*/
		System.out.println("Szomszed beallitva ");
	}
	
	
	/**
	 * Átállítja a jégtábla tárgyát a megadott tárgyra
	 * @param t - a tárgy, amire át akarjuk állítani
	 */
	public void setTargy(Targy t)
	{
		System.out.println("Jegtabla: most epp a rajtam levo targyat akarjak allitani");
		targy = t;
		System.out.println("Jegtabla: Targy atallitva");
	}
	
	/**
	 * Visszaadja, hogy mi ez az objektum
	 */
	public String toString()
	{
		return "Jegtabla";
	}
	
	public int getJatekosokSzama()
	{
		if(this.jatekosok != null)
			return this.jatekosok.size();
		else
			return 0;
	}
	
	public Targy getTargy()
	{
		return this.targy;
	}
	
	public int getSzomszedokSzama()
	{
		return szomszedokSzama;
	}
	

}
